% OUTLINE
% =======
%
% 1. Introduction
%
%   Here I will introduce the need for a new high-fidelity, low-frequency map of the sky. The
%   justifications are: 21 cm foreground mapping, galactic structure (?), others?
%
% 2. Observations
%
%   2.1 - Introduce the Owens Valley LWA
%   2.2 - Describe the 100 hour dataset
%   2.3 - Calibration strategy
%   2.4 - Source removal strategy
%   2.5 - Horizon RFI suppression strategy
%   2.6 - Beam fitting work
%   2.7 - Ionospheric conditions
%
% 3. Imaging
%
%   Give a brief overview of other widefield imaging algorithms. This should set the context for the
%   advantages of m-mode analysis.
%
%   3.1 - Introduce m-mode analysis imaging
%   3.2 - Describe my implementation of m-mode analysis on the ASTM
%   3.3 - L-curves (?)
%   3.4 - CLEAN
%
% 4. Results
%
%   Present sky maps with an estimate of the thermal noise in each pixel. Systematic errors will be
%   described in the following sub-sections.
%
%   4.1 - Horizon RFI
%   4.2 - Ionospheric effects
%   4.3 - Beam errors
%   4.4 - Peeling failures
%
% 5. Discussion
%
%   Compare with the Haslam map and Jayce's map.
%
% 6. Conclusion
%
% FIGURES
% =======
%
% * Antenna layout of the OVRO-LWA
% * Before/after snapshot image of the RFI removal
% * Image of the empirical beam (with source tracks)
% * Plot of ionospheric scintillation and refraction of an A-team source
% * Example L-curve
% * Zoom-in of the dirty PSF
% * Sky maps with their boot-strapped thermal noise estimates
% * (Model) image of the horizontal stripes that show up if the horizon RFI is not removed
% * (Model) image of the PSF distortion from ionospheric effects (scintillation, refraction)
% * (Model) image of the systematic errors in the map created from beam errors
% * (Model) image of the errors created from sporadic peeling failures

\documentclass[twocolumn]{aastex6}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{natbib}

\renewcommand{\b}{\pmb}
\renewcommand{\d}{{\rm d}}
\newcommand{\atikh}{\b{\hat a}_\text{Tikhonov}}
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}\PackageWarning{TODO:}{#1!}}

\begin{document}

\title{The Radio Sky at Meter Wavelengths: $m$-Mode Analysis Imaging with the Owens Valley Long Wavelength Array}

\author{
    Michael W. Eastwood,
    Gregg Hallinan
}

\begin{abstract}
    I present all-sky maps of the sky from the Owens Valley Long Wavelength Array.
    These maps are created from the application of $m$-mode analysis.
\end{abstract}

\section{Introduction}

Studies of the cosmic microwave background (CMB) have given us an unprecedented understanding of the
universe during the epoch of recombination \citep{2013ApJS..208...19H, 2014A&A...571A..16P,
2016A&A...594A..13P}. Before arriving at the Earth, the light from the CMB propagates through the
intergalactic medium (IGM), intervening galaxies and galaxy clusters, and the Milky Way's
interstellar medium (ISM). As photons from the CMB propagate through the intervening material
scattering, absorption, or additional emission can perturb the thermal CMB spectrum. In order to
measure the pristine CMB, these foreground components (eg. synchrotron emission, free-free emission,
thermal dust emission) are a nuisance and careful modeling and removal of these components is
essential \citep{2016A&A...594A..10P, 2016A&A...594A..25P}.

However in many cases the study of CMB foregrounds is scientifically interesting in its own right.
Measurements of dust-correlated anomalous microwave emission \citep{1997ApJ...486L..23L} led to the
discovery of spinning dust emission \citep{1998ApJ...508..157D}. Thomson scattering in the IGM
attenuates the CMB spectrum, but the optical depth implies a mean redshift to the Epoch of
Reionization (EoR) of $8.8^{+1.7}_{-1.4}$ \citep{2016A&A...594A..13P}.  The thermal
Sunyaev-Zel'dovich effect \citep{1970CoASP...2...66S, 1972CoASP...4..173S} has been used to discover
new galaxy clusters \citep{2010ApJ...722.1180V} and measure the distance to galaxy clusters when
combined with X-ray measurements \citep{2006ApJ...647...25B}.

\todo{kinetic SZ effect puts an upper limit on the duration of reionization}

At redshifts $20 \gtrsim z \gtrsim 7$ the 21 cm hyperfine structure line of neutral hydrogen is
expected to produce a 10 to 100 mK perturbation in the CMB spectrum \citep{2006PhR...433..181F,
2012RPPh...75h6901P}. The amplitude of this perturbation on a given line-of-sight is a function of
the neutral fraction of hydrogen, the baryon overdensity, the spin temperature relative to the CMB
temperature at the given redshift, and the line-of-sight peculiar velocity of the gas.

\todo{discuss 21cmmc ionizing efficiency, photon mean free path, minimum halo mass}
\todo{discuss what can be learned from global experiments}

The spatial power spectrum of this perturbation is expected to be dominated
by inhomogeneous heating of the IGM at $z\sim 20$ \citep{2014MNRAS.437L..36F}, and by growing
ionized bubbles during the EoR at $z\sim 7$ \todo{citation}.

Current 21 cm cosmology experiments can be broadly separated into two classes: global experiments
that are aiming to detect the spectral signature of the cosmologically redshifted 21 cm transition
after averaging over the entire sky, and power spectrum experiments that incorporate angular
information to attempt to measure the spatial power spectrum of cosmological 21 cm perturbations.
Ongoing global experiments include EDGES \citep{2010Natur.468..796B, 2017ApJ...835...49M}, LEDA
\todo{cite Price et al. 2017}, BIGHORNS \citep{2015PASA...32....4S}, SCI-HI
\citep{2014ApJ...782L...9V}, and SARAS 2 \citep{2017arXiv170306647S}.  Ongoing power spectrum
experiments include PAPER/HERA \citep{2015ApJ...809...61A, 2016arXiv160607473D}, LOFAR
\citep{2017ApJ...838...65P}, and the MWA \citep{2016ApJ...833..102B}.

Just as for CMB experiments, foreground removal or suppression is an essential component of both
classes of 21 cm cosmology experiments. The brightness temperature of the galactic synchrotron
emission at high galactic latitudes is measured by \citet{2008AJ....136..641R} as
\begin{equation}
    T \sim 300\,{\rm K} \times \left(\frac{\nu}{150\,{\rm MHz}}\right)^{-2.5}\,.
\end{equation}
Therefore experiments conservatively need to achieve at least 4 orders of dynamic range against this
foreground emission before the cosmological signal can be measured. Current foreground removal
methods (for example, \citealt{2012ApJ...756..165P}) rely on the assumption that the foreground
emission (after convolving with the instrumental response) is spectrally smooth. However the
low-frequency radio sky is composed of several components: galactic synchrotron emission, free-free
emission and absorption, supernova remnants, radio galaxies, and a confusing background of point
sources.  Ideally a foreground removal strategy should be informed by the measured spatial and
frequency structure of all foreground components. However, this possibility is limited by the
availability of suitable high-fidelity low-frequency sky maps on angular scales ranging from tens of
degrees to arcminutes.

The Global Sky Model (GSM) \citep{2008MNRAS.388..247D, 2017MNRAS.464.3486Z} is a data-driven
interpolation of various maps between 10 MHz and 100 GHz. However the majority of information
contained in the GSM is derived at higher frequencies where the majority of the input maps are from.
Below 408 MHz, the interpolation is largely driven by the Haslam 408 MHz map
\citep{1981A&A...100..209H, 1982A&AS...47....1H}.  At lower frequencies, free-free absorption and
synchrotron self-absorption becomes increasingly important and hence spectral indices derived at
higher frequencies need corrections at lower frequencies.





\citet{2011A&A...525A.138G}


\todo{TGSS, MSSS, GLEAM}










\section{Observations}

\subsection{The Owens Valley Long Wavelength Array}

\begin{figure}[t]
    \centering
    \includegraphics[width=\columnwidth]{figures/antenna-layout}
    \caption{
        This figure shows the antenna layout for the OVRO-LWA. Black dots correspond to antennas
        within the 200 m diameter core of the array. The 32 open circles are the expansion antennas
        built in early 2016 in order to increase the longest baseline to 1.5 km. The 5 crosses are
        antennas equipped with noise-switched front ends.
    }
    \label{fig:antenna-layout}
\end{figure}

The Owens Valley Long Wavelength Array (OVRO-LWA) is a 288-element interferometer located at the
Owens Valley Radio Observatory (OVRO) near Big Pine, California.  The OVRO-LWA is a low-frequency
instrument with instantaneous bandwidth covering 27.384 MHz to 84.912 MHz and 24 kHz channelization.
Each antenna stand hosts two perpendicular broadband dipoles so that there are $288\times2$ signal
paths in total. These signal paths feed into the 512-input LEDA correlator
\citep{2015JAI.....450003K}, which allows the OVRO-LWA to capture the entire visible hemisphere in a
single snapshot image.  In the current configuration 32 antennas (64 signal paths) are unused.

The 288 antennas are arranged in a pseudo-random configuration optimized to minimize sidelobes in
snapshot imaging.  251 of the antennas are contained within a 200 m diameter core. 32 antennas are
placed outside of the core in order to extend the maximum baseline length out to $\sim$1.5 km. The
final 5 antennas are equipped with noise-switched front ends for calibrated total power measurements
of the global sky brightness.  These antennas are used as part of the LEDA experiment \todo{cite
Price et al. 2017} to measure the global signal of 21 cm absorption from the cosmic dawn.
Figure~\ref{fig:antenna-layout} is a diagram of the antenna configuration.

\todo{cite Gregg's instrument paper}

Beginning at 2017-02-17 12:00:00 UTC time, 28 consecutive hours of data was collected. This time was
chosen based on the fact that it was raining at OVRO and rain tends to improve the low-frequency RFI
environment considerably. During this time the OVRO-LWA operated as a zenith-pointing drift scanning
interferometer.  The correlator dump time was selected to be 13 seconds such that the correlator
output evenly divides a sidereal day.

\todo{describe the ionospheric conditions at the time}

\subsection{Gain Calibration}

Antenna gain calibration is accomplished using an iterative method independently developed by
\citet{2008ISTSP...2..707M} and \citet{2014A&A...571A..97S}. The calibration routine is written in
the Julia programming language \citep{doi:10.1137/141000671}, and is publicly available
online\footnote{\url{https://github.com/mweastwood/TTCal.jl}} under an open source license (GPLv3+).

The antenna complex gains are updated once per day from a 9 hour track of data when Cas A and Cyg A
are at high elevations \todo{the rainy day dataset actually uses a shorter track of data, we should
try using the 9 hour track again}.  These two sources are -- by an order of magnitude -- the
brightest radio sources in the northern hemisphere.  Therefore the optimal time to solve for the
interferometer's gain calibration is when Cas A and Cyg A are at high elevations. A calibration
obtained in this manner is good consistent with the following day's calibration to within a 1\%
error in the flux scale and 1$'$ error in the astrometry \todo{double check these numbers}. These
residual errors are likely driven by differing ionospheric conditions.

The flux scale is tied to the work of \citet{2016arXiv160905940P}.

Temperature fluctuations within the electronics shelter generate 0.1 dB sawtooth oscillations in the
analog gain. These oscillations occur with a variable 15 to 17 minute period. The amplitude of these
gain fluctuations is calibrated by smoothing the autocorrelation amplitudes on 45 minute timescales.
The ratio of the measured auto-correlation power to the smoothed auto-correlation power defines a
per-antenna amplitude correction that is then applied to the cross-correlations.

\subsection{Primary Beam Measurements}

In order to generate wide-field images of the sky, the response of the antenna to the sky must be
known. Fortunately drift-scanning interferometers like the OVRO-LWA can empirically measure their
primary beam under a mild set of symmetry assumptions \citep{2012AJ....143...53P}. In this work we
assume that the primary beam is invariant under north-south and east-west flips, and additionally
that the $x$- and $y$-dipoles have the same response to the sky after rotating one by 90$^\circ$.
We measure the flux of several point sources \todo{which ones??} as they pass through the sky and
then fit a beam model composed of Zernike polynomials to those flux measurements. We select the
basis functions to have the desired symmetry.

\subsection{Source Removal}

\subsubsection{Cassiopeia A and Cygnus A}

Without removing bright sources from the data, sidelobes from bright sources will dominate the
variance in the image.  At 74 MHz Cyg A is a 15,000 Jy source \citep{2016arXiv160905940P}. A
conservative estimate for the confusion limit at 74 MHz with a 10 arcminute beam is 500 mJy
\citep{2012RaSc...47.0K04L}. Therefore we require that Cyg A's sidelobes be at most of $-$45 dB down
from its peak flux to prevent Cyg A's sidelobes from dominating the variance in the image.
\todo{Measure Cyg A's sidelobe levels if it is not subtracted}

At low frequencies, propagation effects through the ionosphere must be accounted for in order to
achieve high dynamic range images. This necessitates the use of direction-dependent calibration and
peeling \citep{2008ISTSP...2..707M, 2015MNRAS.449.2668S}.  In the dataset used in this paper,
scintillation and diffraction events on the timescale of a single integration (13 seconds) are
observed. Therefore the direction dependent calibration changes on these timescales and the we must
solve for one set of complex gains per source per integration.

The largest angular scale of Cas A is $\sim$8 arcminutes, while the largest angular scale of Cyg A
is $\sim$2 arcminutes. With a 10 arcminute resolution, the OVRO-LWA marginally resolves both
sources. A resolved source model is needed for both sources. We fit a self-consistent resolved
source model to eachs ource. This is performed by minimizing the minimizing the variance within an
aperture located on each source after peeling. By phasing up a large number of integrations before
imaging (at least over 1 hour) it is possible to smear out the contribution of the rest of the sky.
We then use NLopt's Sbplx routine \citep{nlopt, sbplx} to vary the parameters in a source model
until the variance within the aperture is minimized.

\todo{Show a before and after with the updated source models}

\todo{Give a plot with the updated source models}

\subsubsection{The Sun}

The Sun can be trivially removed from any map of the sky by constructing the map using only data
taken at night. A map of the entire sky can be obtained by using observations spaced 6 months apart.
However the dataset used in this paper consists of 28 consecutive hours. Additionally while most
astronomical sources at these frequencies have negative spectral indices, the Sun has a large
positive spectral index. Therefore more care will need to be taken in subtracting the Sun at higher
frequencies than at lower frequencies.

\todo{describe sun removal -- this isn't entirely settled yet}

\subsubsection{Sparking Power Lines}

The Owens Valley is an important source of water and power for the city of Los Angeles.
Unfortunately this means that high voltage power lines run along the valley to the west of the OVRO-
LWA. Some of these power line poles have faulty insulators that arc and produce pulsed, broadband
RFI. Because these poles exist in the near-field of the array, we have been able to localize some of
them by using the curvature of the incoming wavefront. Efforts are currently underway to work with
the utility pole owners to have these insulators replaced.

In the meantime it is possible to suppress their contamination in the dataset. The contribution of
these RFI sources to the visibilities can be plainly seen by averaging $>$24 hours of data with the
phase center set to zenith. In this way, true sky components are smeared along tracks of constant
declination while terrestrial sources (ie. the arcing power lines) are not smeared. For similar
reasons, when constructing a map of the sky from $>$24 hours of data these sparking power lines will
produce artifacts in the map that are smeared along tracks of constant declination. However while
the amplitude of the RFI will fluctuate with time, its phase will be constant. Therefore if you can
use isolate a set of model visibilities for the RFI, it can be removed from each integration by
scaling and subtracting these model visibilities from the measured visibilities.

Obtaining a model for the RFI is complicated by the fact that the contaminating sources are at
extremely low elevations where the antenna response is maximally inhomogeneous. Therefore it is not
enough to know the physical location of the faulty insulator generating the RFI. In addition you
must also know the response of each antenna (amplitude and phase) in the appropriate direction. This
motivates the use of peeling, which allows the antenna response to be a free parameter.

Therefore model visibilities for the RFI can be obtained by peeling the sources after smearing the
visibilities over $>$24 hours. These model visibilities are then scaled and subtracted from each
integration in the data set.

\todo{show an example smeared image before and after peeling}

%\begin{figure*}[ht]
%    \centering
%    \begin{tabular}{cccc}
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw04-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw06-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw08-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw10-small} \\
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw12-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw14-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw16-small} &
%        \includegraphics[width=0.22\textwidth]{figures/smeared-snapshots/spw18-small} \\
%    \end{tabular}
%    \caption{
%        Dirty snapshot images after smearing the visiblities over the entire 100 hour observation
%        window.  The two bright source tracks correspond to Cas A (top track) and Cyg A (bottom
%        track) smeared along a ring of constant declination. The sources dotting the horizon are
%        faulty power line insulators.
%    }
%\end{figure*}

\section{Imaging}

The goal of all imaging algorithms is to estimate the brightness of the sky $I_\nu(\hat r)$ in the
direction $\hat r$ and frequency $\nu$. A radio interferometer measures the visibilities
$V_{ij,\nu}$ between pairs of antennas -- here numbered $i$ and $j$ respectively. If the antennas
are separated by the baseline $\vec b_{ij}$, and $A_\nu(\hat r)$ describes their response to the
incident radiation, then
\begin{equation}\label{eq:basic-imaging}
    V^{ij}_\nu = \int_\text{sky}
                 A_\nu(\hat r) I_\nu(\hat r)
                 \exp\bigg(2\pi i \hat r\cdot\vec b_{ij}/\lambda\bigg) \,\d\Omega \, .
\end{equation}
Imaging the output of a radio interferometer therefore consists of estimating $I_\nu(\hat r)$ given
the available measurements $V^{ij}_\nu$.

Naively one might attempt to solve equation~\ref{eq:basic-imaging} by discretizing, and subsequently
solving the resulting matrix equation. If the interferometer is composed of $N_\text{base}$
baselines, and measures $N_\text{freq}$ frequency channels over $N_\text{time}$ integrations then
the entire data set consists of $N_\text{base}N_\text{freq}N_\text{time}$ complex numbers. If the
sky is discretized into $N_\text{pix}$ pixels then the relevant matrix has dimensions of
$(N_\text{base}N_\text{freq}N_\text{time})\times(N_\text{pix})$. For making single-channel maps with
the OVRO-LWA this becomes a 5 petabyte array (assuming each matrix element is a 64-bit complex
floating point number).  This matrix equation is therefore prohibitively large, and solving
equation~\ref{eq:basic-imaging} by means of discretization is usually impossible although
\citet{2017MNRAS.465.2901Z} demonstrate this technique with the MITEOR telescope.

Instead it is common to make mild assumptions that simplify equation~\ref{eq:basic-imaging} and ease
the computational burden in solving for $I_\nu(\hat r)$. For example, when all of the baselines
$\vec b_{ij}$ lie in a plane and the field-of-view is small, equation~\ref{eq:basic-imaging} can be
well-approximated by a two-dimensional Fourier transform \citep{2001isra.book.....T}. The
restriction on baseline co-planarity and field-of-view can be relaxed by using W-projection
\citep{2008ISTSP...2..647C}. Known primary beam effects can also be accounted for during imaging by
using A-projection \citep{2013ApJ...770...91B}.

\subsection{$m$-Mode Analysis}

On the other hand, transit telescopes can take advantage of a symmetry in
equation~\ref{eq:basic-imaging} that greatly reduces the amount of computer time required to image
the full-sky with exact incorporation of widefield imaging effects. This technique, called $m$-mode
analysis, also obviates the need for gridding, mosaicing, and multi-scale deconvolution. Instead the
entire sky is imaged in one coherent synthesis imaging step.

In this context we will define a transit telescope as any interferometer where the response pattern
of the individual elements does not change with respect to time. This may be an interferometer like
the OVRO-LWA where the correlation elements are fixed dipoles, but it may also be an interferometer
like LOFAR or the MWA if the steerable beams are held in a fixed position (not necessarily at
zenith).

We will briefly summarize $m$-mode analysis below, but the interested reader should consult
\citet{2014ApJ...781...57S, 2015PhRvD..91h3514S} for a complete derivation.

For a transit telescope, the visibilities $V^{ij}_\nu$ are a periodic function of sidereal
time\footnote{
    This is not strictly true. Ionospheric fluctuations and non-sidereal sources (such as the sun)
    will violate this assumption. This paper will, however, demonstrate that the impact on the final
    maps is mild.
}.
Therefore it is a very natural operation to compute the Fourier transform of the visibilities with
respect to sidereal time $\phi\in[0,2\pi)$.
\begin{equation}
    V^{ij}_{m,\nu} = \int_0^{2\pi} V^{ij}_\nu(\phi)\exp\bigg(-im\phi\bigg)\,\d\phi
\end{equation}
The output of this Fourier transform is the set of $m$-modes $V^{ij}_{m,\nu}$ where
$m=0,\,\pm1,\,\pm2,\,\ldots$ is the Fourier conjugate variable to the sidereal time. The $m$-mode
corresponding to $m=0$ is a simple average of the visibilities over sidereal time. Similarly $m=1$
corresponds to the component of the visibilities that varies over half-day timescales. Larger values
of $m$ correspond to components that vary on quicker timescales.

\todo{introduce the baseline transfer function because I will want to use it in later sections}

It can be shown that there is a discrete linear relationship between the $m$-modes $V^{ij}_{m,\nu}$
and the spherical harmonic coefficients of the sky brightness $a_{lm,\nu}$.
\begin{equation}\label{eq:m-mode-sum-equation}
    V^{ij}_{m,\nu} = \sum_l B^{ij}_{lm,\nu} a_{lm,\nu}\,,
\end{equation}
where the transfer coefficients $B^{ij}_{lm,\nu}$ define the interferometer's response to the sky.
For example, the transfer coefficients are a function of the baseline and antenna primary beam
pattern.

Equation~\ref{eq:m-mode-sum-equation} can be recognized as a matrix equation where the transfer
matrix $\b B$ is block-diagonal.
\begin{equation}
    \b B = \left(\begin{array}{cccc}
        m = 0 &&& \\
              & m=\pm1 && \\
              && m=\pm2 & \\
              &&& \ddots \\
    \end{array}\right)
\end{equation}
The vector $\b v$ contains the list of $m$-modes and the vector $\b a$ contains the list of
spherical harmonic coefficients representing the sky brightness. In order to take advantage of the
block-diagonal structure in $\b B$, $\b v$ and $\b a$ must be sorted by the value of $m$.
\begin{equation}\label{eq:m-mode-matrix-equation}
    \overbrace{\left(
        \begin{array}{c}
            \vdots \\
            m\text{-modes} \\
            \vdots \\
        \end{array}
    \right)}^{\b v}
    =
    \overbrace{\left(
        \begin{array}{ccc}
            \ddots & & \\
            & \text{transfer matrix} & \\
            & & \ddots \\
        \end{array}
    \right)}^{\b B}
    \overbrace{\left(
        \begin{array}{c}
            \vdots \\
            a_{lm} \\
            \vdots \\
        \end{array}
    \right)}^{\b a}
\end{equation}

In practice we now need to pick the set of spherical harmonics we will use to represent the sky. For
an interferometer like the OVRO-LWA with lots of short baselines, a sensible choice is to use all
spherical harmonics with $l\le l_\text{max}$ for some $l_\text{max}$. The parameter $l_\text{max}$
is determined by the maximum baseline length of the interferometer.  For an interferometer without
short spacings, a minimum value for $l$ might also be used. This $l_\text{min}$ parameter should be
determined by the minimum baseline length.  When creating the maps presented in this paper, we use
$l_\text{min} = 0$ and $l_\text{max} = 1000$.

The interferometer's sensitivity to $l=0$, however, deserves special consideration.
\citet{2016ApJ...826..116V} prove -- under fairly general assumptions -- that an interferometer is
only sensitive to the monopole of the sky brightness if there exists some form of cross-talk or
common-mode noise. In fact, the sensitivity of the interferometer is proportional to the amplitude
of these effects. For consistency we will include $a_{00}$ while solving
Equation~\ref{eq:m-mode-matrix-equation} for the vector $\b a$, but we set $a_{00} = 0$ afterwards
because we do not have a measurement of the amplitude of cross-talk or common-mode noise, which
would be needed to correctly calibrate $a_{00}$.

The size of a typical block in the transfer matrix is
$(2N_\text{base}N_\text{freq})\times(l_\text{max})$. If each element of the matrix is stored as a
64-bit complex floating point number, a single block is 500 MB for the case of single-channel
imaging with the OVRO-LWA. Compare this number with the 5 PB required for the naive approach.  The
power of $m$-mode analysis is the block-diagonal structure of
equation~\ref{eq:m-mode-matrix-equation}.  By breaking up the problem into $N$ independent blocks,
the computational complexity involved in inverting the equation is reduced by a factor $N^3$. For
the case of the OVRO-LWA the equation breaks up into $\sim10^3$ blocks and so we save a factor of
$\sim10^9$ in processing time by using $m$-mode analysis.

\subsection{$m$-Mode Analysis Imaging}

Imaging in $m$-mode analysis essentially amounts to inverting
equation~\ref{eq:m-mode-matrix-equation} to solve for the spherical harmonic coefficients $\b a$.
The linear-least squares solution, which minimizes $\|\b v - \b B\b a\|^2$, is given by
\begin{equation}
    \b{\hat a}_\text{LLS} = (\b B^*\b B)^{-1}\b B^*\b v\,,
\end{equation}
where $^*$ indicates the conjugate-transpose. However, usually one will find that $\b B$ is not
full-rank and hence $\b B^*\b B$ is not an invertible matrix. For example, an interferometer located
in the northern hemisphere will never see a region of the southern sky centered on the southern
celestial pole. The $m$-modes contained in the vector $\b v$ must contain no information
about the sky around the southern celestial pole, and therefore the act of multiplying by $\b B$
must destroy some information about the sky. The consequence of this fact is that $\b B$ must have
at least one singular value that is equal to zero. It is then trivial to show that $\b B^*\b B$ must
have at least one eigenvalue that is equal to zero, which means it is not an invertible matrix.

Another way of looking at the problem is that because the interferometer is not sensitive to part of
the southern hemisphere, there are infinitely many possible solutions to
equation~\ref{eq:m-mode-matrix-equation} that will fit the measured data equally well. So we need to
regularize the problem and apply an additional constraint that prefers a unique solution. For
example, you may prefer that in the absence of any information the sky should be set to zero or you
may prefer that the sky should be set to some prior expectation.

\subsubsection{Tikhonov Regularization}

The process of Tikhonov regularization minimizes $\|\b v - \b B\b a\|^2 + \epsilon\|\b a\|^2$ for
some arbitrary value of $\epsilon > 0$ chosen by the observer. The solution that minimizes this
expression is given by
\begin{equation}\label{eq:tikhonov-solution}
    \atikh = (\b B^*\b B + \epsilon\b I)^{-1}\b B^*\b v\,.
\end{equation}
Tikhonov regularization adds a small value $\epsilon$ to the diagonal of $\b B^*\b B$, fixing the
matrix's singularity. We can see this by using the singular value decomposition (SVD) of the matrix
$\b B = \b U \b \Sigma \b V^*$. Equation~\ref{eq:tikhonov-solution} becomes
\begin{equation}
    \atikh = \b V (\b\Sigma^2 + \epsilon \b I)^{-1}\b\Sigma \b U^*\b v\,,
\end{equation}
where
\[
    \b\Sigma = \left(
        \begin{array}{ccc}
            \sigma_1 & & \\
                     & \sigma_2 & \\
                     & & \ddots \\
        \end{array}
    \right)\,.
\]
The diagonal elements of $\b\Sigma$ are the singular values of $\b B$ and so the contribution of
each singular component to the Tikhonov-regularized solution is scaled by $\sigma_i / (\sigma_i^2 +
\epsilon)$, where $\sigma_i$ is the singular value for the $i$th singular component. Tikhonov
regularization therefore acts to suppress any component for which $\sigma_i\lesssim\sqrt{\epsilon}$.
If $\sigma_i = 0$, the component is set to zero.

In practice the measurement $\b v$ is corrupted by noise with covariance $\b N$. For illustrative
purposes we will assume that $\b N=n\b I$ for some scalar $n$. In this case the covariance of the
Tikhonov-regularized spherical harmonic coefficients is
\begin{equation}
    \b C = n \b V (\b\Sigma^2 + \epsilon\b I)^{-2} \b\Sigma^2 \b V^*\,.
\end{equation}
Each singular component is scaled by a factor of $\sigma_i^2/(\sigma_i^2 + \epsilon)^2$.
In the absence of Tikhonov regularization ($\epsilon=0$)
singular components with the smallest singular values -- the ones that the interferometer is
the least sensitive to -- actually come to dominate the covariance of the measured spherical
harmonic coefficients. Tikhonov regularization improves this situation by downweighting these
components.

While Tikhonov regularization will force unmeasured modes to zero, if a prior map of the sky already
exists, it will be preferrable to instead minimize $\|\b v - \b B\b a\|^2 + \epsilon \|\b a-\b
a_\text{prior}\|^2$.

\subsubsection{L-Curves}

Tikhonov regularization requires the observer to pick the value of $\epsilon$. If $\epsilon$ is too
large then too much importance is placed on minimizing the norm of the solution and the
least-squares residuals will suffer. However if $\epsilon$ is too small then the problem will be
poorly regularized and the resulting sky map may not represent the true sky. Picking the value of
$\epsilon$ therefore requires understanding the trade-off between the two norms.

This trade-off can be analyzed quantitatively by trialing several values of $\epsilon$ and computing
$\|\b v - \b B\b a\|^2$ and $\|\b a\|^2$ for each trial. An example is shown in Figure \todo{create
a figure}. The shape of this curve has a characteristic L-shape, and as a result this type of plot
is called an L-curve \todo{reference}. The ideal value of $\epsilon$ lies near the turning point of
the plot. At this point a small decrease in $\epsilon$ will lead to an undesired rapid increase in
$\|\b a\|^2$, and a small increase in $\epsilon$ will lead to an undesired rapid increase in $\|\b v
- \b B\b a\|^2$.

In practice, the L-curve should be used as a guide to estimate a reasonable value of $\epsilon$.
However better results can often be obtained by tuning the value of $\epsilon$. For instance
increasing the value of $\epsilon$ can improve the noise properties of the map by down-weighting
noisy modes. Decreasing the value of $\epsilon$ can improve the resolution in the map by
up-weighting the contribution of longer baselines, which are likely fewer in number. In this respect
choosing the value of $\epsilon$ is analagous to picking the weighting scheme in traditional
imaging where robust weighting schemes can be tuned to similar effect. \todo{citation}

\subsubsection{The Moore-Penrose Pseudoinverse}

The Moore-Penrose pseudoinverse (denoted in this paper with a superscript $\dagger$), is commonly
applied to find the minimum-norm linear-least squares solution to a set of linear equations. This
can be used in place of Tikhonov regularization as
\begin{equation}
    \b{\hat a}_\text{Moore-Penrose} = \b B^\dagger\b v\,.
\end{equation}
Much like Tikhonov regularization, the Moore-Penrose pseudoinverse sets components with small
singular values (below some user-defined threshold) to zero. Components with large singular values
(above the user-defined threshold) are included in the calculation at their full amplitude with no
down-weighting of modes near the threshold. The essential difference between using the Moore-Penrose
pseudoinverse and Tikhonov regularization is that the pseudoinverse defines a hard transition from
on to off. Modes are either set to zero or included in the map at their full amplitude. On the other
hand Tikhonov regularization smoothly interpolates between these behaviors. Because of this,
Tikhonov regularization tends to produce better results in practical applications.

\subsection{Image Deconvolution}

While $m$-mode analysis imaging automatically deconvolves large angular scales, point sources do not
get deconvolved by the imaging process. This is a limitation of the set of basis functions we have
chosen to represent the sky -- the spherical harmonics. Point sources carry power to large values of
$l$, but the regularization will eventually begin to downweight spherical harmonics with $l$ larger
than what the interferometer is sensitive to. This consequence of this is that point sources will
appear in the maps with some characteristic point spread function. This point spread function may be
computed with
\begin{equation}
    \b a_\text{PSF}(\theta, \phi)
        = (\b B^*\b B + \epsilon\b I)^{-1}\b B^*\b B\b a_\text{PS}(\theta, \phi)\,,
\end{equation}
where $\b a_\text{PSF}(\theta, \phi)$ is the vector of spherical harmonic coefficients representing
the point spread function at the spherical coordinates $(\theta, \phi)$, and $\b a_\text{PS}(\theta,
\phi)$ is the vector of spherical harmonic coefficients for a point source at $(\theta, \phi)$ given
by
\begin{equation}
    a_{lm, \text{PS}}(\theta, \phi) = Y_{lm}^*(\theta, \phi)\,.
\end{equation}

\todo{include a few images of the computed PSF for my maps}

\todo{describe how we incorporate this into major and minor iterations}

\section{Errors}

\subsection{Terrestrial Interference}

When writing down equation~\ref{eq:basic-imaging}, it is implicitly assumed that the correlated
voltage fluctuations measured between pairs of antennas are generated by astronomical sources of
radio emission. In practice, this implicit assumption can be violated. For instance a low-frequency
interferometer located in the vicinity of an arcing power line will see an additional contribution
from the radio-frequency interference (RFI) generated by the arcing process. Similarly common-mode
pickup along the analog signal path of the interferometer may generate an additional spurious
contribution to the measured visibilities. While the amplitude and phase of these contaminating
signals may fluctuate with time, they do not sweep across the sky at the sidereal rate
characteristic of astronomical sources.

The first step in equation~\ref{eq:tikhonov-solution} is to compute $\b B^*\b v$. In this step we
compute the projection of the measurement $\b v$ onto the space spanned by the columns of $\b B$.
Each column of $\b B$ describes the interferometer's response to a corresponding spherical harmonic
coefficient of the sky brightness distribution. Therefore the act of computing $\b B^*\b v$ is to
project the measured $m$-modes onto the space of $m$-modes which could be generated by astronomical
sources. The degree to which a source of terrestrial interferer will contaminate a map generated
using $m$-mode analysis imaging is determined by its amplitude after projection.

For instance, a bright interfering source might contribute $\b v_\text{terrestrial}$ to the measured
$m$-modes. However, if $\b v_\text{terrestrial}$ is actually perpendicular to all of the columns of
$\b B$, there will be no contamination in the map because $\b B^*\b v_\text{terrestrial} = 0$.  In
practice this is unlikely. In general the contamination is proportional to the overall amplitude of
the interference ($\|\b v_\text{terrestrial}\|$) and the degree to which the interference mimics
an astronomical signal ($\|\b B^*\b v_\text{terrestrial}\|/\|\b v_\text{terrestrial}\|$).

















These astronomical sources are anchored to the celestial sphere and therefore rotate
across the sky over the course of a sidereal day. Terrestrial source of interference are not
anchored to the celestial sphere.

This characteristic motion of astronomical sources
is a fundamental component to $m$-mode analysis imaging

radio emission is astronomical. Astronomical sources are anchored to the celestial sphere and
therefore rotate across the sky over the course of a sidereal day. However, in a practice 

$m$-mode analysis imaging implicitly assumes that the correlation between any two pairs of antennas


However it is instructive to analyze the contaminating effect the RFI will have
on $m$-mode analysis maps of the sky. The correlation observed on a given
baseline and frequency channel for a single source of RFI is
\begin{equation}
    V(t) = I(t) B^\textrm{near-field}
\end{equation}

However we need a strategy to mitigate the RFI before imaging. A constant source attached to the
horizon has a fringe rate of zero. The only possible astronomical origins for a source with zero
fringe rate are:

\begin{enumerate}
    \item a point source located at the north or south celestial poles, and
    \item a ring of constant declination.
\end{enumerate}

Therefore while snapshot images will show the RFI source on the horizon, extended integrations will
show the RFI as rings of constant declination. We can take advantage of this discrepancy to separate
astronomical emission from terrestrial RFI.

\subsection{Beam Errors}

\begin{itemize}
    \item declination dependent flux scale errors
    \item failure to reconcile observations from two separate times
\end{itemize}

\subsection{Ionospheric Scintillation}

One of the key assumptions made by $m$-mode analysis is that the sky is completely static.  We
assume that the only time-dependent behavior is the rotation of the Earth, which slowly rotates the
sky through the fringe patterns of the interferometer. At low frequencies the ionosphere violates
this assumption. In particular, ionospheric scintillation will cause even static sources to exhibit
significant variability.

The correlation observed on a given baseline for a single point source is
\begin{equation}
    V_\nu(t_{\textrm{sidereal}}) = I_\nu B_\nu(t_{\textrm{sidereal}}),
\end{equation}
where $I_\nu$ is the flux of the source at the frequency $\nu$, and $B_\nu$
is the baseline transfer function. The transfer function is a function of
the direction to the source, which is in turn a function of the sidereal
time $t_{\textrm{sidereal}}$. If the source is varying, from intrinsic
variability or due to scintillation, than the source flux is also a function
of the time coordinate $t$ such that
\begin{equation}
    V_\nu(t_{\textrm{sidereal}}) = I_\nu(t) B_\nu(t_{\textrm{sidereal}}),
\end{equation}
where $t_{\textrm{sidereal}} = (t \mod 23.9345\,\textrm{hours})$.

Now assume we have observed with our interferometer for a single sidereal day.
In order to compute the $m$-modes we must Fourier transform with respect to
sidereal time. In a real measurement this is a discrete Fourier transform of
the observed correlation with respect to time (where the sum over time is
restricted to a sidereal day). \todo{fix normalization}
\begin{equation}
    V_{\nu, m} = \sum_{t} V_\nu(t) e^{-imt}
\end{equation}
Define $V_{\nu, m}^{\textrm{static}}$ to be the observed $m$-modes if the source
was actually static ($I_\nu(t) \equiv I_{\nu,0}$). Then as a consequence of the
Fourier convolution theorem
\begin{equation}
    V_{\nu, m} = \sum_{m^\prime} V_{m^\prime}^\textrm{static} I_{\nu, m-m^\prime}.
\end{equation}

This will tend to scatter power between $m$-modes.

Simulate images of point sources with this


\subsection{Ionospheric Refraction}




\section{Results}

\subsection{Sky Maps}

\begin{figure*}[ht]
    \includegraphics[width=\textwidth]{maps/rgb-map-small}
    \caption{three color map}
\end{figure*}

\begin{figure*}[ht]
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
    \end{tabular}
    \caption{single channel maps}
\end{figure*}

\begin{figure*}[ht]
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} &
        \includegraphics[width=\columnwidth, draft]{maps/rgb-map} \\
    \end{tabular}
    \caption{jackknifed error maps}
\end{figure*}

\begin{table*}[t]
    \centering
    \begin{tabular}{ccccc}
        \hline\hline
        \# & $\nu$ / MHz & $\Delta\nu$ / MHz
           & $\theta$ / arcmin  & noise / Jy \\ \hline
        1 & 36.528 & 0.024 & & \\
        2 & 41.760 & 0.024 & & \\
        3 & 46.992 & 0.024 & & \\
        4 & 52.224 & 0.024 & & \\
        5 & 57.456 & 0.024 & & \\
        6 & 62.688 & 0.024 & & \\
        7 & 67.920 & 0.024 & & \\
        8 & 73.152 & 0.024 & & \\
        \hline\hline
    \end{tabular}
    \caption{Summary of the produced maps}
\end{table*}

\subsection{Error Maps}


\todo{Cite Abhilash, Eastwood 2017}

\section{Discussion}

These maps are pretty cool.

\bibliographystyle{apj}
\bibliography{paper}

\end{document}

